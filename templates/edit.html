<!DOCTYPE html>
<html lang="vi">
<head>
	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <meta charset="UTF-8">
    <title>Chá»‰nh sá»­a thÃ­ sinh</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            display: grid;
            grid-template-columns: 200px 1fr;
            row-gap: 12px;
            column-gap: 20px;
            max-width: 800px;
            margin: auto;
        }
        label {
            text-align: left;
            padding-top: 6px;
            font-weight: bold;
        }
        input, select {
			text-align: left;
            padding: 6px;
            width: 100%;
            box-sizing: border-box;
        }
        .row-full {
            grid-column: 1 / -1;
        }
        .truong-filter {
            display: flex;
            gap: 10px;
        }
        .truong-filter > div {
            flex: 1;
        }
		.checkbox-label {
			display: inline-flex;
			text-align: left;
			gap: 6px;
			margin-right: 15px;
			margin-bottom: 6px;
		}
		fieldset {
			margin-bottom: 12px;
		}
		.section {
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 8px;
			margin-bottom: 20px;
		}

		.section legend {
			font-weight: bold;
		}

		.form-row {
			display: flex;
			align-items: center;
			margin: 6px 0;
		}
		.form-row input[type="checkbox"] {
			margin-right: 10px;
			transform: scale(1.2);
		}
		.form-row label {
			margin-right: 10px;
			flex: 1;
			min-width: 250px;
		}
		.form-row input[type="text"] {
			flex: 2;
			padding: 4px 8px;
			border: 1px solid #ccc;
			border-radius: 4px;
		}	  
		.form-row select {
			flex: 2;
			height: 34px;
			padding: 4px 8px;
			border: 1px solid #ccc;
			border-radius: 4px;
		}
    </style>
</head>
<body>
    <h2 style="text-align:center;">Chá»‰nh sá»­a/CÃ¢Ì£p nhÃ¢Ì£t thÃ´ng tin</h2>
    <form method="POST">
		<h3>1. ThÃ´ng tin thiÌ sinh</h3><br>
        <input type="hidden" name="MaTSXT" value="{{ ts.MaTSXT }}" readonly>
		
        <label>MÃ£ sá»‘:</label>
        <input type="text" name="Maso" value="{{ ts.Maso }}" readonly>

		<label>Há» vÃ  TÃªn:</label>
			<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
				<input type="text" name="Holot" value="{{ ts.Holot or ''}}" placeholder="Há» lÃ³t">
				<input type="text" name="Ten" value="{{ ts.Ten or ''}}" placeholder="TÃªn">
		</div>
		
        <label>Giá»›i tÃ­nh:</label>
        <select name="Gioitinh">
            <option value="0" {% if ts.Gioitinh == 0 %}selected{% endif %}>Nam</option>
            <option value="1" {% if ts.Gioitinh == 1 %}selected{% endif %}>Ná»¯</option>
        </select>

        <label>NgÃ y sinh:</label>
        <input type="date" name="Ngaysinh" value="{{ ts.Ngaysinh.strftime('%Y-%m-%d') if ts.Ngaysinh else '' }}">
		
		<label>NÆ¡i sinh:</label>
		<input type="text" name="Noisinh" value="{{ ts.Noisinh or ''}}" placeholder="NÆ¡i sinh, chiÌ‰ nhÃ¢Ì£p tÃªn TiÌ‰nh">
		
		<label>CÄƒn cÆ°Æ¡Ìc cÃ´ng Ä‘Ã¢n:</label>
			<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
				<input type="text" name="SoCMND" value="{{ ts.SoCMND or ''}}" placeholder="SÃ´Ì CCCD">
				<input type="date" name="NgaycapCMND" value="{{ ts.NgaycapCMND.strftime('%Y-%m-%d') if ts.NgaycapCMND else '' }}">
				<select name="NoicapCMND">
					<option value="Cá»¥c trÆ°á»Ÿng CCSQLHC vá» TTXH" {% if ts.NoicapCMND == "Cá»¥c trÆ°á»Ÿng CCSQLHC vá» TTXH" %}selected{% endif %}>Cá»¥c trÆ°á»Ÿng CCSQLHC vá» TTXH</option>
					<option value="BÃ´Ì£ CÃ´ng An" {% if ts.NoicapCMND == "BÃ´Ì£ CÃ´ng An" %}selected{% endif %}>BÃ´Ì£ CÃ´ng An</option>
					<option value="CA tiÌ‰nh CaÌ€ Mau" {% if ts.NoicapCMND == "CA tiÌ‰nh CaÌ€ Mau" %}selected{% endif %}>CA tiÌ‰nh CaÌ€ Mau</option>					
					<option value="CA tiÌ‰nh BaÌ£c LiÃªu" {% if ts.NoicapCMND == "CA tiÌ‰nh BaÌ£c LiÃªu" %}selected{% endif %}>CA tiÌ‰nh BaÌ£c LiÃªu</option>
					<option value="CA tiÌ‰nh KiÃªn Giang" {% if ts.NoicapCMND == "CA tiÌ‰nh KiÃªn Giang" %}selected{% endif %}>CA tiÌ‰nh KiÃªn Giang</option>
					<option value="CA tiÌ‰nh SoÌc TrÄƒng" {% if ts.NoicapCMND == "CA tiÌ‰nh SoÌc TrÄƒng" %}selected{% endif %}>CA tiÌ‰nh SoÌc TrÄƒng</option>
				</select>
			</div>   

        <label>DÃ¢n tÃ´Ì£c:</label>
        <select name="MaDT">
		{% for dt in dantoc %}
			<option value="{{ dt[0] }}" {% if dt[0] == ts.MaDT %}selected{% elif not ts.MaDT and dt[0] == 'KIN' %}selected{% endif %}>{{ dt[1] }}</option>
		{% endfor %}
		</select>
		
		<label>TÃ´n giaÌo:</label>
        <select name="MaTG">
		{% for tg in tongiao %}
			<option value="{{ tg[0] }}" {% if tg[0] == ts.MaTG %}selected{% elif not ts.MaTG and tg[0] == 'KHO' %}selected{% endif %}>{{ tg[1] }}</option>
		{% endfor %}
		</select>
		
		<label>ÄÃ´Ìi tÆ°Æ¡Ì£ng chiÌnh saÌch:</label>
        <select name="MaDTCS">
		<option value="">-- Chá»n Ä‘Ã´Ìi tÆ°Æ¡Ì£ng chiÌnh saÌch --</option>
		{% for cs in dtcs %}
			<option value="{{ cs[0] }}" {% if cs[0] == ts.MaDTCS %}selected{% elif not ts.MaDTCS and cs[0] == 'KHO' %}selected{% endif %}>{{ cs[1] }} - [{{ cs[2] }}]</option>
		{% endfor %}
		</select>
		
		<label>Há»™ kháº©u/Äá»‹a chá»‰:</label>
		<div style="display: flex; gap: 10px;">
			<input type="text" name="Hokhau" id="Hokhau" value="{{ ts.Hokhau or '' }}" readonly>
			<button type="button" onclick="openDiaChiModal()" style="padding: 6px 18px;">ğŸ—ºï¸ Chá»n Ä‘á»‹a chá»‰</button>
		</div>
		
		<label>ÄiÃªÌ£n thoaÌ£i:</label>
        <input type="text" name="Dienthoai" value="{{ ts.Dienthoai or '' }}">
		
		<label>Email:</label>
        <input type="text" name="Email" value="{{ ts.Email or '' }}">
		
		<label>Ghi chuÌ:</label>
        <input type="text" name="Ghichu" value="{{ ts.Ghichu or ''}}">
		
	<h3>2. ThÃ´ng tin hÃ´Ì€ sÆ¡ </h3><br>
	<div class="row-full">
    <fieldset class="section">
        <legend>Há»“ sÆ¡ chung</legend>
		<div class="form-row">
			<label>PhiÃªÌu Ä‘Äƒng kyÌ dÆ°Ì£ tuyÃªÌ‰n (*)</label>
			<input type="checkbox" name="hs1" value="1" {% if hoso.hs1 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>SÆ¡ yÃªÌu lyÌ liÌ£ch (*)</label>
			<input type="checkbox" name="hs2" value="1" {% if hoso.hs2 %}checked{% endif %}>
		</div>
        <div class="form-row">
			<label>GiÃ¢Ìy khai sinh</label>
			<input type="checkbox" name="hs3" value="1" {% if hoso.hs3 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>CMND/CCCD (*)</label>
			<input type="checkbox" name="hs12" value="1" {% if hoso.hs12 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>02 aÌ‰nh maÌ€u (3x4)</label>
			<input type="checkbox" name="hs11" value="1" {% if hoso.hs11 %}checked{% endif %}>
		</div>

    </fieldset>
    <fieldset>
        <legend><strong>Há»“ sÆ¡ cao Ä‘áº³ng</strong></legend>
		<div class="form-row">
			<label>BÄƒÌ€ng TN THPT (*)</label>
			<input type="checkbox" name="hs4" value="1" {% if hoso.hs4 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>GCN TN THPT taÌ£m thÆ¡Ì€i (*)</label>
			<input type="checkbox" name="hs5" value="1" {% if hoso.hs5 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>HoÌ£c baÌ£ THPT (*)</label>
			<input type="checkbox" name="hs8" value="1" {% if hoso.hs8 %}checked{% endif %}>
		</div>
    </fieldset>
    <fieldset>
        <legend><strong>Há»“ sÆ¡ trung cáº¥p</strong></legend>
		<div class="form-row">
			<label>BÄƒÌ€ng TN THCS (*)</label>
			<input type="checkbox" name="hs6" value="1" {% if hoso.hs6 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>GCN TN THCS taÌ£m thÆ¡Ì€i (*)</label>
			<input type="checkbox" name="hs7" value="1" {% if hoso.hs7 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>HoÌ£c baÌ£ THCS (*)</label>
			<input type="checkbox" name="hs9" value="1" {% if hoso.hs9 %}checked{% endif %}>
		</div>
    </fieldset>
    <fieldset>
        <legend><strong>Há»“ sÆ¡ liÃªn thÃ´ng</strong></legend>
		<div class="form-row">
			<label>BÄƒÌ€ng TN Trung cÃ¢Ìp (*)</label>
			<input type="checkbox" name="hs15" value="1" {% if hoso.hs15 %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>HoÌ£c baÌ£/BaÌ‰ng Ä‘iÃªÌ‰m VH (*)</label>
			<input type="checkbox" name="hs16" value="1" {% if hoso.hs16 %}checked{% endif %}>
		</div>
    </fieldset>
	<fieldset>
        <legend><strong>ThÃ´ng tin bá»• sung</strong></legend>
		<div class="form-row">
			<label>NÃ´Ì£p online</label>
			<input type="checkbox" name="NopOnline" value="1" {% if hoso.NopOnline %}checked{% endif %}>
		</div>
		<div class="form-row">
			<label>TiÃªÌp cÃ¢Ì£n thÃ´ng tin</label>
			<select name="MaTiepCan">
				<option value="1" {% if hoso.MaTiepCan == "1" %}selected{% endif %}>MaÌ£ng xaÌƒ hÃ´Ì£i Facebook hoÄƒÌ£c Zalo cuÌ‰a TrÆ°Æ¡Ì€ng</option>
				<option value="2" {% if hoso.MaTiepCan == "2" %}selected{% endif %}>Website cuÌ‰a TrÆ°Æ¡Ì€ng</option>				
				<option value="3" {% if hoso.MaTiepCan == "3" %}selected{% endif %}>BaÌo & ÄaÌ€i truyÃªÌ€n thanh, truyÃªÌ€n hiÌ€nh</option>
				<option value="4" {% if hoso.MaTiepCan == "4" %}selected{% endif %}>AÌp phiÌch, bÄƒng-rÃ´n, tÆ¡Ì€ rÆ¡i</option>
				<option value="5" {% if hoso.MaTiepCan == "5" %}selected{% endif %}>HÄTS Ä‘ÃªÌn TrÆ°Æ¡Ì€ng PT tÆ° vÃ¢Ìn</option>
				<option value="6" {% if hoso.MaTiepCan == "6" %}selected{% endif %}>ThÃ¢Ì€y, CÃ´ trong TrÆ°Æ¡Ì€ng PT thÃ´ng tin</option>
				<option value="7" {% if hoso.MaTiepCan == "7" %}selected{% endif %}>CÆ°Ì£u HSSV</option>
				<option value="8" {% if hoso.MaTiepCan == "8" %}selected{% endif %}>HSSV Ä‘ang hoÌ£c</option>
			</select>
		</div>
		<div class="form-row">
			<label>GiÃ¢Ìy tÆ¡Ì€ Æ°u tiÃªn</label>
			<input type="textbox" name="hs13" value="{{ hoso.hs13 or '' }}" >
		</div>
		<div class="form-row">
			<label>ÄiÃªÌ£n thoaÌ£i phuÌ£ huynh</label>
			<input type="textbox" name="SoDT" value="{{ hoso.SoDT or ''}}">
		</div>
		<div class="form-row">
			<label>Ghi chuÌ hÃ´Ì€ sÆ¡</label>
			<input type="textbox" name="Ghichuthem" value="{{ hoso.GhiChu or ''}}">
		</div>
    </fieldset>
</div>

	<h3>3. ThÃ´ng tin xeÌt tuyÃªÌ‰n</h3><br>
	    <div class="row-full truong-filter">
            <div>
                <label for="search-truong">Lá»c trÆ°á»ng:</label>
                <input type="text" id="search-truong" placeholder="Nháº­p tá»« khoÃ¡...">
            </div>
            <div>
                <label>TrÆ°á»ng THPT:</label>
                <select name="MaTHPT" id="truong-select">
                    {% for trg in matruong %}
                        <option value="{{ trg[0] }}" {% if trg[0] == ts.MaTHPT %}selected{% elif not ts.MaTHPT and trg[0] == '015' %}selected{% endif %}>
                            {{ trg[1] }} - [{{ trg[2] }}]
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
		<label>TÃ´Ìt nghiÃªÌ£p:</label>
		<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		<select name="NamTN">
            {% for year in range(2000, current_year+1) %}
                <option value="{{ year }}" {% if ts.NamTN == year %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
		</select>
		<select name="Fld01">
			<option value="TN THCS" {% if ts.Fld01 == "TN THCS" %}selected{% endif %}>TN THCS</option>
			<option value="TN THPT" {% if ts.Fld01 == "TN THPT" %}selected{% endif %}>TN THPT</option>
			<option value="LÆ¡Ìp 10" {% if ts.Fld01 == "LÆ¡Ìp 10" %}selected{% endif %}>LÆ¡Ìp 10</option>
			<option value="LÆ¡Ìp 11" {% if ts.Fld01 == "LÆ¡Ìp 11" %}selected{% endif %}>LÆ¡Ìp 11</option>
			<option value="Äang lÆ¡Ìp 12" {% if ts.Fld01 == "Äang lÆ¡Ìp 12" %}selected{% endif %}>Äang lÆ¡Ìp 12</option>
			<option value="HoaÌ€n thaÌ€nh THPT" {% if ts.Fld01 == "HoaÌ€n thaÌ€nh THPT" %}selected{% endif %}>HoaÌ€n thaÌ€nh THPT</option>
			<option value="Trung cÃ¢Ìp" {% if ts.Fld01 == "Trung cÃ¢Ìp" %}selected{% endif %}>Trung cÃ¢Ìp</option>
			<option value="Cao Ä‘ÄƒÌ‰ng" {% if ts.Fld01 == "Cao Ä‘ÄƒÌ‰ng" %}selected{% endif %}>Cao Ä‘ÄƒÌ‰ng</option>
			<option value="ÄaÌ£i hoÌ£c" {% if ts.Fld01 == "ÄaÌ£i hoÌ£c" %}selected{% endif %}>ÄaÌ£i hoÌ£c</option>
		</select>
		</div>
		
		<label>Nguyá»‡n vá»ng 1:</label>
		<select name="MaNG1">
			<option value="">-- Chá»n ngÃ nh --</option>
			{% for ng in nganhhoc %}
			<option value="{{ ng[0] }}" {% if ng[0] == mang1 %}selected{% endif %}>{{ ng[1] }}</option>
			{% endfor %}
		</select>

		<label>Nguyá»‡n vá»ng 2:</label>
		<select name="MaNG2">
			<option value="">-- Chá»n ngÃ nh --</option>
			{% for ng in nganhhoc %}
			<option value="{{ ng[0] }}" {% if ng[0] == mang2 %}selected{% endif %}>{{ ng[1] }}</option>
			{% endfor %}
		</select>

		<label>Nguyá»‡n vá»ng 3:</label>
		<select name="MaNG3">
			<option value="">-- Chá»n ngÃ nh --</option>
			{% for ng in nganhhoc %}
			<option value="{{ ng[0] }}" {% if ng[0] == mang3 %}selected{% endif %}>{{ ng[1] }}</option>
			{% endfor %}
		</select>

		<label>ToaÌn:</label>
		<input type="number" step="0.1" name="Diem1" value="{{ diem1 }}">

		<label>NgÆ°Ìƒ vÄƒn:</label>
		<input type="number" step="0.1" name="Diem2" value="{{ diem2 }}">

		<label>NgoaÌ£i ngÆ°Ìƒ:</label>
		<input type="number" step="0.1" name="Diem3" value="{{ diem3 }}">
		

		<div class="row-full" style="text-align:center; margin-top: 20px;">
			<div style="display: inline-flex; gap: 12px; justify-content: center;">
				<button type="submit" name="action" value="luu_toan_bo"
					style="padding:8px 16px; background:green; color:white; border:none; border-radius:4px; font-size:16px; cursor:pointer;">
					ğŸ’¾ LÆ°u toÃ n bá»™ thay Ä‘á»•i
				</button>
				<a href="{{ url_for('phieu_nhan_hoso', matsxt=ts.MaTSXT) }}" target="_blank"
					style="display:inline-block; padding:8px 16px; background:green; color:white; text-decoration:none; border-radius:4px; font-size:16px;">
					ğŸ–¨ï¸ In phiáº¿u nháº­n há»“ sÆ¡
				</a>
				<!-- NÃºt má»Ÿ popup -->
				<button type="button" onclick="openModal()"
						style="display:inline-block; padding:8px 16px; background:green; color:white; text-decoration:none; border-radius:4px; font-size:16px;">
					ğŸ” Cáº­p nháº­t trÃºng tuyá»ƒn/nháº­p há»c/In giáº¥y bÃ¡o
				</button>
			</div>
		</div>
	</form>	

	<!-- Modal (popup) -->
	<form method="post" action="">
		<div id="modalTrungTuyen" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5);">
			<div style="background-color:white; margin:5% auto; padding:20px; border-radius:10px; width:60%; max-width:600px; position:relative;">
			  
				<!-- Fieldset: Cáº­p nháº­t trÃºng tuyá»ƒn -->
				<fieldset style="border: 1px solid #ccc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
					<legend style="font-weight:bold;">ğŸ” Cáº­p nháº­t trÃºng tuyá»ƒn/nháº­p há»c</legend>
					<!-- Tráº¡ng thÃ¡i trÃºng tuyá»ƒn -->
					<div style="margin-top:1px;">
						<label style="display:block; margin-bottom:5px;"></label>
						<div style="padding-left: 10px;">
						{% if nv_trung_tuyen %}
						ThÃ­ sinh Ä‘Ã£ trÃºng tuyá»ƒn nguyá»‡n vá»ng {{ nv_trung_tuyen }}.
						{% else %}
						ThÃ­ sinh chÆ°a trÃºng tuyá»ƒn
						{% endif %}
						</div>
					</div>
				<!-- Chá»n nguyá»‡n vá»ng -->
				<div style="display:flex; align-items:center; margin-top:15px; gap:10px;">
				  <label for="nv_trungtuyen" style="width: 140px;">TruÌng tuyÃªÌ‰n:</label>
				  <select name="nv_trungtuyen" id="nv_trungtuyen" required style="flex:1; padding:6px;">
					{% if not nv_trung_tuyen %}
					  <option value="" selected>-- Chá»n nguyá»‡n vá»ng Ä‘ÃªÌ‰ xeÌt tuyÃªÌ‰n --</option>
					{% endif %}
					<option value="1" {% if nv_trung_tuyen == 1 %}selected{% endif %}>Nguyá»‡n vá»ng 1</option>
					<option value="2" {% if nv_trung_tuyen == 2 %}selected{% endif %}>Nguyá»‡n vá»ng 2</option>
					<option value="3" {% if nv_trung_tuyen == 3 %}selected{% endif %}>Nguyá»‡n vá»ng 3</option>
				  </select>
				</div>

				<!-- Checkbox nháº­p há»c -->
				<div style="display:flex; align-items:center; margin-top:15px; gap:10px;">
					<label for="nhaphoc" style="width: 140px;">Nháº­p há»c:</label>
					<select name="nhaphoc" id="nhaphoc" style="flex:1; padding:6px;">
						<option value="0" {% if ts.Nhaphoc in (0, '', None) %}selected{% endif %}>ChÆ°a laÌ€m thuÌ‰ tuÌ£c nhÃ¢Ì£p hoÌ£c</option>
						<option value="1" {% if ts.Nhaphoc == 1 %}selected{% endif %}>ÄaÌƒ laÌ€m thuÌ‰ tuÌ£c nhÃ¢Ì£p hoÌ£c</option>
					</select>
				</div>

				<!-- NÃºt hÃ nh Ä‘á»™ng -->
				<div style="display:flex; justify-content:center; gap: 12px; margin-top: 25px; flex-wrap: wrap;">
				  <button type="submit" name="action" value="xettuyen" style="padding:8px 16px; background:#007bff; color:white; border:none; border-radius:4px;">
					âœ… Cáº­p nháº­t
				  </button>
				  <button type="button" onclick="closeModal()" style="padding:8px 16px; background:#dc3545; color:white; border:none; border-radius:4px;">
					âŒ ThoÃ¡t
				  </button>
				</div>
			  </fieldset>

			  {% if nv_trung_tuyen %}
			  <!-- Fieldset: In giáº¥y bÃ¡o -->
			  <fieldset style="border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
				<legend style="font-weight:bold;">ğŸ–¨ï¸ In giáº¥y bÃ¡o</legend>

				<!-- Chá»n ngÆ°á»i kÃ½ -->
				<div style="display:flex; align-items:center; margin-top:15px; gap:10px;">
				  <label for="nguoiky" style="width: 130px;">NgÆ°Æ¡Ì€i kyÌ:</label>
				  <select name="nguoiky" id="nguoiky" required style="flex:1; padding:6px;">
					<option value="1">TÆ°Ì€ HoaÌ€ng Ã‚n</option>
					<option value="2">TrÆ°Æ¡ng Thanh DuÌƒng</option>
					<option value="3">HuyÌ€nh Minh HiÃªÌu</option>
				  </select>
				</div>

				<!-- NÃºt in -->
				<div style="display:flex; justify-content:center; margin-top: 25px;">
				  <button type="button" onclick="inGiayBao()" style="padding:8px 16px; background:#28a745; color:white; border:none; border-radius:4px;">
					ğŸ–¨ï¸ In giáº¥y bÃ¡o
				  </button>
				</div>
			  </fieldset>
			  {% endif %}
		  </div>
		</div>
	</form>
	<!-- POPUP chá»n Ä‘á»‹a chá»‰ -->
	<div id="diaChiModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:1000;">
	  <div style="background:white; margin:5% auto; padding:20px; border-radius:8px; width:90%; max-width:500px; position:relative;">
		<h3>ğŸ“ Nháº­p Ä‘á»‹a chá»‰</h3>

		<div style="margin-bottom:10px;">
		  <label>Tá»‰nh:</label>
			<select id="select-tinh">
				<option value="">-- Chá»n Tá»‰nh --</option>
				{% for tinh in tinhthanh %}
				<option value="{{ tinh.Maso }}">{{ tinh.Tinhthanh }}</option>
				{% endfor %}
			</select>
		</div>
		
		<div style="margin-bottom:10px;">
		  <label>XÃ£/PhÆ°á»ng:</label>
			<select id="select-xa">
				<option value="">-- Chá»n XÃ£/PhÆ°á»ng --</option>
			</select>
		</div>
		
		<div style="margin-bottom:10px;">
		  <label>KhÃ³m/áº¤p:</label>
		  <input type="text" id="khomap" placeholder="KhÃ³m, áº¤p..." style="width:100%;">
		</div>

		<div style="text-align:right; margin-top:20px;">
		  <button type="button" onclick="confirmDiaChi()" style="padding:6px 12px; background:green; color:white; border:none; border-radius:4px;">âœ… XÃ¡c nháº­n</button>
		  <button type="button" onclick="closeDiaChiModal()" style="padding:6px 12px; background:gray; color:white; border:none; border-radius:4px;">âŒ ÄÃ³ng</button>
		</div>
	  </div>
	</div>

	<script>
		function inGiayBao() {
			const nguoiky = document.getElementById('nguoiky').value;
			const matsxt = "{{ ts.MaTSXT }}";  // biáº¿n tá»« Flask
			const url = "{{ url_for('giay_bao') }}?matsxt=" + matsxt + "&nguoiky=" + nguoiky;
			//const url = "{{ url_for('giay_bao') }}?matsxt=" + encodeURIComponent(matsxt) + "&nguoiky=" + encodeURIComponent(nguoiky);
			window.open(url, "_blank");
		}

		function openDiaChiModal() {
			document.getElementById('diaChiModal').style.display = 'block';
		}

		function closeDiaChiModal() {
			document.getElementById('diaChiModal').style.display = 'none';
		}

		// GhÃ©p Ä‘á»‹a chá»‰
		function confirmDiaChi() {
			const khomap = document.getElementById('khomap').value.trim();
			const xa = document.getElementById('xa').value;
			const tinh = document.getElementById('tinh').value;

			if (!xa || !tinh) {
				alert("Vui lÃ²ng chá»n Ä‘áº§y Ä‘á»§ XÃ£ vÃ  Tá»‰nh.");
				return;
			}

			let diachi = "";
			if (khomap) {
				diachi += khomap + ", ";
			}
			diachi += xa + ", " + tinh;

			document.getElementById('Hokhau').value = diachi;
			closeDiaChiModal();
		}
		
		document.getElementById('select-tinh').addEventListener('change', function () {
			const matinh = this.value;
			const xaSelect = document.getElementById('select-xa');
			xaSelect.innerHTML = '<option value="">Äang táº£i...</option>';

			if (!matinh) {
				xaSelect.innerHTML = '<option value="">-- Chá»n XÃ£/PhÆ°á»ng --</option>';
				return;
			}

			fetch(`/api/xa_phuong/${matinh}`)
				.then(response => response.json())
				.then(data => {
					xaSelect.innerHTML = '<option value="">-- Chá»n XÃ£/PhÆ°á»ng --</option>';
					data.forEach(xa => {
						const opt = document.createElement('option');
						opt.value = xa.MaXa;
						opt.textContent = xa.TenXa;
						xaSelect.appendChild(opt);
					});
				})
				.catch(error => {
					console.error("Lá»—i táº£i xÃ£/phÆ°á»ng:", error);
					xaSelect.innerHTML = '<option value="">KhÃ´ng táº£i Ä‘Æ°á»£c dá»¯ liá»‡u</option>';
				});
		});
		function removeDiacritics(str) {
			return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
		}

		document.getElementById('search-truong').addEventListener('input', function () {
			const searchTerms = removeDiacritics(this.value.toLowerCase()).split(/\s+/);
			const select = document.getElementById('truong-select');
			const options = select.querySelectorAll('option');

			options.forEach(option => {
				if (option.value === '') return;

				const text = removeDiacritics(option.text.toLowerCase());
				const matched = searchTerms.every(term => text.includes(term));
				option.style.display = matched ? 'block' : 'none';
			});
		});
		
		function confirmDiaChi() {
			const khomap = document.getElementById('khomap').value.trim();
			const xa = document.getElementById('select-xa');
			const tinh = document.getElementById('select-tinh');

			if (!xa.value || !tinh.value) {
				alert("Vui lÃ²ng chá»n Ä‘áº§y Ä‘á»§ Tá»‰nh vÃ  XÃ£.");
				return;
			}

			const diachi = `${khomap ? khomap + ', ' : ''}${xa.options[xa.selectedIndex].text}, ${tinh.options[tinh.selectedIndex].text}`;
			document.getElementById('Hokhau').value = diachi;
			closeDiaChiModal();
		}
		
		function openModal() {
			document.getElementById('modalTrungTuyen').style.display = 'block';
		}

		function closeModal() {
			document.getElementById('modalTrungTuyen').style.display = 'none';
			// Optional: quay láº¡i trang edit hoáº·c reload láº¡i trang
			window.location.href = "{{ url_for('edit', matsxt=ts.MaTSXT) }}";
		}

		// Click ngoÃ i popup Ä‘á»ƒ Ä‘Ã³ng
		window.onclick = function (event) {
			let modal = document.getElementById('modalTrungTuyen');
			if (event.target == modal) {
			closeModal();
			}
		}
	</script>
</body>
</html>
